{
  "ignition": {
    "version": "3.3.0"
  },
  "passwd": {
    "users": [
      {
        "name": "core",
        "sshAuthorizedKeys": [
          "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFwjm/GjkqaLR3SA93Cif7U0X4GRbpsb3ussYZwTSHAZ steven@kore",
          "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBJ0MSYF8SY9eZoGKe1rhPvrm58FiMxQMJf69WEeBUTn steve51516@gmail.com"
        ]
      }
    ]
  },
  "storage": {
    "directories": [
      {
        "path": "/etc/containers/containers.conf.d"
      },
      {
        "path": "/usr/local/etc/k3d"
      },
      {
        "path": "/root/.kube"
      },
      {
        "path": "/usr/local/etc/k3d/manifests"
      },
      {
        "path": "/root/.bashrc.d"
      },
      {
        "path": "/home/core/.bashrc.d"
      },
      {
        "path": "/var/data"
      }
    ],
    "disks": [
      {
        "device": "/dev/vdb",
        "partitions": [
          {
            "label": "containers",
            "number": 1,
            "sizeMiB": 0
          }
        ],
        "wipeTable": true
      }
    ],
    "files": [
      {
        "overwrite": false,
        "path": "/root/.bashrc.d/docker_sock",
        "contents": {
          "compression": "",
          "source": "data:,EDITOR%3D%2Fusr%2Fbin%2Fvim%0ADOCKER_SOCK%3D%2Frun%2Fpodman%2Fpodman.sock%0A"
        }
      },
      {
        "overwrite": false,
        "path": "/home/core/.bashrc.d/kubectl",
        "contents": {
          "compression": "",
          "source": "data:;base64,a3ViZWN0bCgpIHsKICAgIHBvZG1hbiBleGVjIC1pdCAiazNkLSR7Q0xVU1RFUn0tc2VydmVyLTAiIGt1YmVjdGwgIiR7QH0iCn0K"
        }
      },
      {
        "overwrite": false,
        "path": "/home/core/.bashrc.d/cluster",
        "contents": {
          "compression": "",
          "source": "data:,export%20CLUSTER%3Dtitan%0A"
        }
      },
      {
        "overwrite": false,
        "path": "/root/.bashrc.d/kubectl",
        "contents": {
          "compression": "",
          "source": "data:;base64,a3ViZWN0bCgpIHsKICAgIHBvZG1hbiBleGVjIC1pdCAiazNkLSR7Q0xVU1RFUn0tc2VydmVyLTAiIGt1YmVjdGwgIiR7QH0iCn0K"
        }
      },
      {
        "overwrite": false,
        "path": "/root/.bashrc.d/cluster",
        "contents": {
          "compression": "",
          "source": "data:,export%20CLUSTER%3Dtitan%0A"
        }
      },
      {
        "overwrite": false,
        "path": "/home/core/.bashrc.d/docker_sock",
        "contents": {
          "compression": "",
          "source": "data:,EDITOR%3D%2Fusr%2Fbin%2Fvim%0ADOCKER_SOCK%3D%2Frun%2Fpodman%2Fpodman.sock%0A"
        }
      },
      {
        "overwrite": true,
        "path": "/usr/local/bin/k3d-installer.sh",
        "contents": {
          "source": "https://raw.githubusercontent.com/k3d-io/k3d/main/install.sh"
        },
        "mode": 493
      },
      {
        "overwrite": true,
        "path": "/usr/local/bin/k3d-create-cluster.sh",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/3RWYW/bNhD9PP2KC2O0GzZZaYN9SeFuXeqtRdMGSFIURVcYtHi2CdGkQFJOAtf/fTiKkmjHM5BIIt/x3j3e8Xh6UsylLubcrSB/yE6zU7hpNNTGeajOBUjtPFcqy9Zc6p9/gW0GAHB59fn2bnozYaNtfL3IvfRc71iY/3D+dnYz/ef97d3NVwKl3xd5dS5yi0vpvH1MDD5N775c33zo8PEzwBNU9Df7+ubjVQdNxy7yonG2UKbkqkBfFtW5oL+8VI3zaMePfK3ieuFfG7DUwME1c7dCpcAbqBBrcKWVtYd2cGHNGvBBeqmXwVIu4Ns3OIF8AYlPkpOU+/79FfgV6gClX6txCewpOI8yox27Ffz4AViuDLAFlwoFsYnztCUnMG05MHj2LPCBF204C5nFiN6AxnuYWymWCBr9vbEVrBvnYY5QWuQeBcyx5I1DIgkCF7xRHmoj1lz3JsKg0899XLW2ZiMFChDadQKcHJrgg3TeARsle8gOlDgwaQkdmBxE9NlJvYS/L69v4a/Gc42gpK5cxxDCQgtjwZk1gkXuTOvPoW/qWetx5kxZoe/WpF1SxlQuGAqas89dr0VHT/M1CmCtmizafsFWz8idNOxSGprA1TQ27EK3zL30q165U9rUFRUZwTrLJ6KWRnsuNdp9WbtSOtSVAupZRGZ5vkE7N47eYmR5R4nweQ2/n52dPZE7iadsrEXt1eO+2twBB6omormQSzC1l1H1EAQtH6sOlHQefsDSYg3hpIBnr6EQuCl0o9RBHHKxZ3skko5bTgl8IEqosacHw47BcFztDqWjn+JzVDNtBLq98db/rGrm2EZ6bJaquzTrWmEvQpSUHqgc9mOhuHME9mZuLFXyeDyGgRosTKPF+F/93hFHi8C1oZcUU1t0qP0ffZ0MhLJdlp0ey/t2zHXJ5Q2UZoNJ5kdYabTGksIIhVGdi+wUPhmPF+BX0sGX91dX8On6DqhQYao30hq9Ru0nb68vP0xvZu+ub+8mjZYPF4VtdNH6i48xOcna4vNWogOuBdBJ51pGwTe9+hX3gFrURmr/G8wbD8WG27BkSzmsFZLRZUfi7duVe3Qe16VXIKTjc0UZpM19DBySxdDDgcWau+oocC8JYi8Jh3qEBRITdowyS8AJ4wn7H7lY0m7yBYwSB0/bjF2HhpSC0hwZIkOdSJF4i6ENQIvOc+uPYJSGnA6lbRJFqLPEOYv5SD20XGFZdZswub18+eLlWZaUXb9j9DWrLS7kAzX5F+2lYRTTP+dL1D42cUpRSf17ezYev9y9AmGyn5Iugw9YQi49sLBEX0K5Q7tBm58xCJXtVXsAACPnxWibcNjlo63csUArt0bhmEysRo9uLE1BKYh24m3TVrkwGinso2dDH2SbADQ5q87FJNxWwteAHYe7S7/97WVj1JnA9yMNYDBubxyvaX86i11/XgzshnOtZzYMTdjo3fXHaRECZvvXHgFsNCDZ01RcV0LafVCaisPwrxNWpACKY5iFJfrYNF4frJb15ylL8CQs3XC4h9F2GN+FVKSLLLDRn+y/AAAA///mu5ZB+woAAA=="
        },
        "mode": 493
      },
      {
        "overwrite": true,
        "path": "/usr/local/etc/k3d/k3d-cluster.yaml",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/6SUQW/rNgzH7/4URHLo9gDHeUjxEGiXdR0GFN0hQLedQ9tMrFkWDYlKlm8/SLbjtGsGDEMOsSnpxz/Jv5zneYa9/oOc12wVtJt6pbk4fUXTN/iYtdrWCt501xvKOhKsUVBlABY7UiBa0Gae3ImcV/A1wyNZSU+W5MyuTchMuCWrYPFWNdSh6Cp/NljnPzk+l4SyzX+3MVP+myOU/K1ne6T0UjXkLvnO6Q6FFlkbSnravUQBS2jYi4JF0rBq2dGq4Y5W6HpcwBJ017MTtAIHdiANwX4QugdPItoeQdsUj9SK7UEfM3hH/Z+Yl52CxXqVfhF1bshR2voaSnKWhDw87V7grI2BksBoL2Qjku3I2LGLcr49Pm7+FTEfjXKvxA77nmoQBrZw4eASFPzFC3XZiU3oyMd25jC8KChO6Io45uJPMuZy0Fb9M5QBAFiu6RdtJM4+BSImOUB9uYPsWDTb3gSvPgv+R2zwrjBcoSlIqqLd1EWHVh/Iy4g3uiwc2uiiot34YpjcvAuWgEEYauoNX+Aav69jIKgvWWzz2Lk+zWi73q7Vdg1L8NgRoId9nqdhPIxLPxrGukSDtiL3sL+f5HZfxn3sTlptN7WCZfwDF6zojiYPDorPqEWBuEDRKqgHz1YmeCEXTVASBI+lISjpwI7AkQSno29+uJUdz+7hu5oOGMyI/D6liEk5REtu1mu/mPKM4QmLJTv5CJ32fFv7WPt8XYbCQ1+j0M9Dytd5caoH6xosnW/LSYYeRcJ85F3WOU0+ZMjHA5/X589aquY5OEdWntkK/TW3FI3n2HGohvW8GjZELfFO3sh78DAu3lMzZJoQn6mJkx5dsUxG+RVLMlefLKNTYkQB9v2qvX4Q4hf83UWdCR+sNmGm2/V3AAAA//9sSeGQDwYAAA=="
        },
        "mode": 384
      },
      {
        "overwrite": false,
        "path": "/etc/hostname",
        "contents": {
          "compression": "",
          "source": "data:,titan.kore.home.arpa.%0A"
        },
        "mode": 420
      },
      {
        "overwrite": false,
        "path": "/etc/containers/containers.conf.d/timeout.conf",
        "contents": {
          "compression": "",
          "source": "data:,%23%20Disable%20podman%20service%20timeout%0Aservice_timeout%3D0%0A"
        }
      },
      {
        "overwrite": false,
        "path": "/etc/systemd/zram-generator.conf",
        "contents": {
          "compression": "",
          "source": "data:;base64,IyBUaGlzIGNvbmZpZyBmaWxlIGVuYWJsZXMgYSAvZGV2L3pyYW0wIGRldmljZSB3aXRoIHRoZSBkZWZhdWx0IHNldHRpbmdzClt6cmFtMF0K"
        },
        "mode": 420
      },
      {
        "path": "/usr/local/etc/k3d/manifests/jellyfin.yaml",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/3xUUXPiNhB+96/YuT4bHNrrNHpjAtehTXJMwl2mfckIaYEtsqRKaze00//ekY0xhvTyFH3+9pP2+5bN8jzPpKevGCI5K6C+yfZktYBlQiKj5a/OVCXeGUllViJLLVmKDEBa61gyORvTEaBuiCPvdCntiNxYB6oxCDBOSZMBqIANf0UlRpalF/BhUky+z4tJXtysJoX4eCt+uP39QwZgZYkC/kBjDhuyuXJ2k0WPqrlZKYzxwWk83pzDE0r9Eojxs1XYYN9dokuns+6RqVbAJzIYD5GxzAACRlcF1UkG/LPCyMcTQGQX5BYF3PxMWWTJVRTwz7/fMNDpgV1GrtEc5aT3fW9XzfZ9bjZkiQ9tkXUapwOkfSUF1LMqkN0+qx3qypDdLrbWneD5G6oq+d5VtVrPaFCxCysMZew/5VBKVrv5mw8YY59u93WPB9HU58EZHO2rNQaLjDEl/pcLewxnfADnMUh2QcDCDj7U0lQ4EE/yHKqUn6zYla6y/IyhJoVTpdJp5fZoBWykiYmlnGVJFkMjkwPauhuI1tJf5vf3v31aPL4uq7WhuEOd9DB8CSY7e4WAHbMX4/FNMfpYjIrRRPxU3P7YUKhsYtdO7TGkHruYTv8IIxkjtyENk0yQd4FPc3p68dIFFnC6BWDnIl+A1/TbSXFN78CIqgrEhztnGd+4c9YHqsngFrXo3E1/Snq5JkNM5yHo4Pz5LNxNl68Pvz5+nl1gj/PV69P05QKdfpktVq8vT4vV/GwjPKTkTg40qS4l7wSMS9Qkjxqtcz0yZCqpdjhg9sgF09kNbQfUwRbJfa3eKdNYp301qNNY5y2GVq4NHmfxnuw+9kPYNnmcwCaWpNiZ36rXMozTIhgPJgOADx4FzCg0v8RDdm1E/s0e/HtburtbpcPjO3u0V+1NxNLzYUbhtO/ob7ynkrjdeH1Jbwr8X7edl/8FAAD//+9JR+leBgAA"
        },
        "mode": 420
      },
      {
        "path": "/usr/local/etc/k3d/manifests/motionplus.yaml",
        "contents": {
          "compression": "",
          "source": "data:,%23%20TODO%20write%20a%20deployment%20for%20motionplus%20with%20init%20container%20for%20secrets"
        },
        "mode": 420
      },
      {
        "path": "/usr/local/etc/k3d/manifests/pihole.yaml",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/8RU32vbMBB+919x9N2Ok1BW9GbSsoU1iUnddu1LUOVrKyLrNEn2Nsb+92FHSWa3ZYzBhh/MHd/9+O6+UxzHETfyBq2TpBk042grdckgbz3Oo/Y3pOoKZ4rLKqrQ85J7ziIArjV57iVp15oATQdMDJUV14mkUWllg5aBIsFVBCAsdvhCVug8rwyDk0k6mcbpJE6nxSRlk5RNT+9PIgDNK2Rg5DMpjBU9Rc6g6MoKgc4tqMSubAxr5OWtlR5XWmAEYNFRbQWGrix+rtH5YAE4T5Y/IYPxexk5z33tGHz/Ef3TSfTYCdKP8n8SpLJHR/EHVCEdN2bf56DtY7+1p4pq7a/QNlJgJkRrFbRFzeCRK9eGCtKeS402kELd7CrEIWu+Xn2621yuZlkxXy0Dl4aruquYhA6O+Jv5urjOLjcfVlfF79Ftb2jneR85TpPTNEmTSQ9b3PdRWYVWCj5a4pfNHdltD9yWX2aLi7dbkFW3jZLEFm0rht38wo8p7tH5Dtkbb+swZPd7jY8TzMl6BqfTUPKZnB+4jCVPghSDYpb/Tfj1+RvhZ+mL8LP0bNw5HYraSv9tRtrjV7/XpeCGP0glvcSDVgFKS+ZoxTDL8s3i43J1PvAtL4rNOrsdeLPr83mxuV3Pi4tfDm/R6u8wt06bOffPDEYNtyNFT6OQZvjIxKYRr0ShF/ulvRa4u98QW2o362x2WKnrtHfoZzx5l7SiG+/tpPsiANT8QWE4o0upt+54P+2cB/rYkQ339CYV89rzddhJayyHT+2LfD2Gf5wyvG9R9DMAAP//AGW3K20GAAA="
        },
        "mode": 420
      }
    ],
    "filesystems": [
      {
        "device": "/dev/disk/by-partlabel/containers",
        "format": "btrfs",
        "path": "/var",
        "wipeFilesystem": true
      }
    ]
  },
  "systemd": {
    "units": [
      {
        "contents": "# Generated by Butane\n[Unit]\nBefore=local-fs.target\nRequires=systemd-fsck@dev-disk-by\\x2dpartlabel-containers.service\nAfter=systemd-fsck@dev-disk-by\\x2dpartlabel-containers.service\n\n[Mount]\nWhere=/var\nWhat=/dev/disk/by-partlabel/containers\nType=btrfs\n\n[Install]\nRequiredBy=local-fs.target",
        "enabled": true,
        "name": "var.mount"
      },
      {
        "enabled": true,
        "name": "podman.socket"
      },
      {
        "enabled": false,
        "mask": true,
        "name": "docker.service"
      },
      {
        "enabled": true,
        "mask": true,
        "name": "docker.socket"
      },
      {
        "enabled": false,
        "mask": true,
        "name": "nm-cloud-setup.service"
      },
      {
        "enabled": false,
        "mask": true,
        "name": "nm-cloud-setup.socket"
      },
      {
        "contents": "[Unit]\nDescription=Install Admin Packages\nAfter=network-online.target\nWants=network-online.target\nConditionPathExists=!/var/lib/%N.stamp\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nRestart=on-failure\nRestartSec=60\nExecStart=/usr/bin/rpm-ostree install -y --apply-live --allow-inactive \\\n    vim \\\n    kubernetes-client\n\nExecStart=/bin/touch /var/lib/%N.stamp\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "rpm-ostree-install-pkgs.service"
      },
      {
        "contents": "[Unit]\nDescription=k3s bootstrapper\nAfter=network-online.target\nWants=network-online.target\nAfter=rpm-ostree-install-k3s-selinux.service\nConditionPathExists=!/var/lib/%N.stamp\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nRestart=on-failure\nEnvironment=DOCKER_SOCK=/run/podman/podman.sock\nExecStartPre=/usr/bin/ln -s /run/podman/podman.sock /var/run/docker.sock\nExecStart=/bin/touch /var/lib/%N.stamp\nExecStart=/usr/local/bin/k3d-create-cluster.sh\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "k3d-install-cluster.service"
      }
    ]
  }
}
