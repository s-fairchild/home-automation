{
  "ignition": {
    "version": "3.3.0"
  },
  "passwd": {
    "users": [
      {
        "name": "core",
        "sshAuthorizedKeys": [
          "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFwjm/GjkqaLR3SA93Cif7U0X4GRbpsb3ussYZwTSHAZ steven@kore",
          "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBJ0MSYF8SY9eZoGKe1rhPvrm58FiMxQMJf69WEeBUTn steve51516@gmail.com"
        ]
      }
    ]
  },
  "storage": {
    "directories": [
      {
        "path": "/etc/containers/containers.conf.d"
      },
      {
        "path": "/usr/local/etc/k3d"
      },
      {
        "path": "/root/.kube"
      },
      {
        "path": "/usr/local/etc/k3d/manifests"
      },
      {
        "path": "/root/.bashrc.d"
      },
      {
        "path": "/home/core/.bashrc.d"
      },
      {
        "path": "/var/data"
      }
    ],
    "disks": [
      {
        "device": "/dev/vdb",
        "partitions": [
          {
            "label": "containers",
            "number": 1,
            "sizeMiB": 0
          }
        ],
        "wipeTable": true
      }
    ],
    "files": [
      {
        "overwrite": false,
        "path": "/root/.bashrc.d/docker_sock",
        "contents": {
          "compression": "",
          "source": "data:,EDITOR%3D%2Fusr%2Fbin%2Fvim%0ADOCKER_SOCK%3D%2Frun%2Fpodman%2Fpodman.sock%0A"
        }
      },
      {
        "overwrite": false,
        "path": "/home/core/.bashrc.d/kubectl",
        "contents": {
          "compression": "",
          "source": "data:;base64,a3ViZWN0bCgpIHsKICAgIHBvZG1hbiBleGVjIC1pdCAiazNkLSR7Q0xVU1RFUn0tc2VydmVyLTAiIGt1YmVjdGwgIiR7QH0iCn0K"
        }
      },
      {
        "overwrite": false,
        "path": "/home/core/.bashrc.d/cluster",
        "contents": {
          "compression": "",
          "source": "data:,export%20CLUSTER%3Dtitan%0A"
        }
      },
      {
        "overwrite": false,
        "path": "/root/.bashrc.d/kubectl",
        "contents": {
          "compression": "",
          "source": "data:;base64,a3ViZWN0bCgpIHsKICAgIHBvZG1hbiBleGVjIC1pdCAiazNkLSR7Q0xVU1RFUn0tc2VydmVyLTAiIGt1YmVjdGwgIiR7QH0iCn0K"
        }
      },
      {
        "overwrite": false,
        "path": "/root/.bashrc.d/cluster",
        "contents": {
          "compression": "",
          "source": "data:,export%20CLUSTER%3Dtitan%0A"
        }
      },
      {
        "overwrite": false,
        "path": "/home/core/.bashrc.d/docker_sock",
        "contents": {
          "compression": "",
          "source": "data:,EDITOR%3D%2Fusr%2Fbin%2Fvim%0ADOCKER_SOCK%3D%2Frun%2Fpodman%2Fpodman.sock%0A"
        }
      },
      {
        "overwrite": true,
        "path": "/usr/local/bin/k3d-installer.sh",
        "contents": {
          "source": "https://raw.githubusercontent.com/k3d-io/k3d/main/install.sh"
        },
        "mode": 493
      },
      {
        "overwrite": true,
        "path": "/usr/local/bin/k3d-create-cluster.sh",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/3RWYW/bNhP+/OpXXBijfQdMVtpgX1K4W5d6a9G0AZIURdEVBi2ebUIUKZCUk8Dxfx+OomTa8Qwkksg73vM8vDvy9KSYS13MuVtB/pCdZqdw02pojPNQnQuQ2nmuVJbVXOr//wKbDADg8urr7d30ZsJGm/h6kXvpud6yMP/p/P3sZvr3x9u7m+9klH5f5NW5yC0upfP2MXH4Mr37dn3zqbePn8E8sYrxZt/ffb7qTdOxi7xonS2UKbkq0JdFdS7oLy9V6zza8SOvVVwv/OsISw0cXDt3K1QKvIEKsQFXWtl46AYX1tSAD9JLvQyecgE/fsAJ5AtIYpKcpNzPn2/Ar1AHU/p1GpfAnhvnUWa0Y7eCpyfAcmWALbhUKAhNnKctOYFph4HBixcBD7zq6CxkFhm9A433MLdSLBE0+ntjK6hb52GOUFrkHgXMseStQwIJAhe8VR4aI2quBxdh0OmXPq7aWLOWAgUI7XoBTg5d8EE674CNkj1kB0ocuHSADlwOGH11Ui/hr8vrW/iz9VwjKKkr1yOEsNDCWHCmRrDIneniOfRtM+sizpwpK/T9mrRLypjKBUdBc/alG7To4WleowDWqcmi7zfs9IzYScM+paENWE1rwy70y9xLvxqUO6VNXVGRkVnv+UzU0mjPpUa7L2tfSoe6EqEBRUSW52u0c+PoLTLLe0hknzfw29nZ2TO5Ez5lay1qrx731eYOOFA1EcyFXIJpvIyqBxK0fKw6UNJ5eIKlxQZCp4AXb6EQuC50q9QBD7nY8z3CpMeWUwIfiBJq7Hlj2LIu8EEs+ik+RzXTRqDbG+8Cz6p2jh3FY7NU1qWpG4UD+6glPVA5HMZCVecI7N3cWCrh8XgMQwvdwsK0Woz/0R8dYbQIXBt6SW0aiw61/30okB2gbJtlp8cSvhtzfVZ5A6VZY5Ly0aw0WmNJNEJFVOciO4UvxuMF+JV08O3j1RV8ub4DqlCY6rW0Rteo/eT99eWn6c3sw/Xt3aTV8uGisK0uunjxMaYgWVd13kp0wLUAanGuQxRi06tfcQ+oRWOk9r/CvPVQrLkNS3aQw1ohC112hO9wTrlH57EuvQIhHZ8rSh1t7iNxSBZDDwceNXfVUcO9JIiHSOjm0SyAmLBjkFlinCCesP+QiyXnTL6AURLg+fli63ASpUZpjuyYoU6kSKJFajtDi85z64/YKA05daNNwmLLgKXBWcxHOjzLFZZVvwmT28vXr16fZUnZDTtGX7PG4kI+0On+qrstjGL653yJ2sfTm1JU0sG9ORuPX2/fgDDZ/5LjBR+whFx6YGGJoYRyh3aNNj9jECrbq64BAKPgxWiTYNjmo43csgArt0bhmFysRo9uLE1BKYh24m3bVbkwGon20d4wkOwSgCZn1bmYhGtK+NrZjsOlZdj+7pYx6l3g55HOv3PurhpvaX96j+3QL3bodn1tQLYbmrDRh+vP0yIQZvv3HQFstLNkz1OxroS0+0ZpKhLa3RQs0ccz4e2BTzZ0TZbYk3x0geEeRpvd+DYkHN1TgY3+YP8GAAD//zIWUBTaCgAA"
        },
        "mode": 493
      },
      {
        "overwrite": true,
        "path": "/usr/local/etc/k3d/k3d-cluster.yaml",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/5RUTW/bMAy9+1cQyaHbAMUpUhSBhgHrOgwoukOAbjuHtplYsywZFJ0s/36Q7HysWwsMOcQmxfceyScrpTLszA/iYLzT0CyqmfH57hptV+NN1hhXaXgybWcpm0JLghUK6gxgCg5b0iBG0GWBeEccNCwy3JKToOE6cyR7z02CzcQ35DRMnsqaWhRTqnuLlfrEfl8QylJ9d5FNfWNCUU+dd1tKL2VNfFArNi0KTbKmL+hu9RAl1D6IhklSMGs806z2Lc2QO5zAFEzbeRZ0AhvPIDXBepC5hkAixm3BuBSPmKV3G7MdUR9WGibzWfpFqH1NTOnoY18QOxIKcLd6gL2xFgoCa4KQi5DejRgrz1Hd7c3N4lWIc2mUe0JsseuoAvHgHRx8zwkUwiEItdnO276lEKegYHjRkO+Q87if/CdZe9iYKAXA+Yq+GCtxPykQa9KW9LsX6lsvxrvO9uE/EfrAufUl2pykzJtFlbfozIaCvII0bEXPsziAsacuTW85X871cg5TCNgSYIC1UmlMV2Pqo/VYFWjRlcRX65dJLs9lvov9pWyzqDRM4x9w78S0dHTHoHiPRjQI9xSXiGZwU2n7IMRxPQVBH7CwBAVtPBMwSc8mbvT9pexYu4Y3FW2wtyPk20QRSX2fzDIPkyPNGD2iYuFZnmMez9zOQ2z97OOh776rUOjzwPh4Th7bwaoCR/vLbpLTRo1wLvmD9UyjBgY1Fvy7vbA3Utb3PTM5ufdO6Nd5omiDjwOHcsircjgQtcTLciHvKsCYfEnNwHSE+FvNFOK+g04Pg0++YkH2FElGiRGdkoq9pVlzuq/x2xi/aMQfIuCp6JnlzuHLe/I7AAD//yZX1iNsBQAA"
        },
        "mode": 384
      },
      {
        "overwrite": false,
        "path": "/etc/hostname",
        "contents": {
          "compression": "",
          "source": "data:,titan.kore.home.arpa.%0A"
        },
        "mode": 420
      },
      {
        "overwrite": false,
        "path": "/etc/containers/containers.conf.d/timeout.conf",
        "contents": {
          "compression": "",
          "source": "data:,%23%20Disable%20podman%20service%20timeout%0Aservice_timeout%3D0%0A"
        }
      },
      {
        "overwrite": false,
        "path": "/etc/systemd/zram-generator.conf",
        "contents": {
          "compression": "",
          "source": "data:;base64,IyBUaGlzIGNvbmZpZyBmaWxlIGVuYWJsZXMgYSAvZGV2L3pyYW0wIGRldmljZSB3aXRoIHRoZSBkZWZhdWx0IHNldHRpbmdzClt6cmFtMF0K"
        },
        "mode": 420
      },
      {
        "path": "/usr/local/etc/k3d/manifests/jellyfin-pvc.yml",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/1yOP28UMRDFe3+Kp1y9y90lFHEbCQqEiCAKEt3EnuWG2J7FMz4UIb47ukvSpHw/vX8bfKMjww8MHb4Ohy7wgxgWKQxqGcMYj+OBkxekzuSMaYErpK7aPWwgDmmu+DQeuDd2tjlswgY3Z3fGH/EDVs2V2nQ1X867QKvcczfRFnHchUdpOeL2RMy5+b2WUfmmkNRQ2SmTUwwAtaZOLtrsJIHj2Tg/d8+i73KXI/eIoolKwPNh0XYnlc2prhEX++3+ctrup+3ubr+N76/j1fWPiwA0qhzxi0t5WqRNSdsSbOV0Xk6JzT5r5pflCV+Z8vcuzl9a4jPbvKW3msPryVM24oMUtidzrgHobDp6eq3s/Huw+YsCzLXTT47YfZRgTj4s4u+/8D8AAP//4NbfbLQBAAA="
        },
        "mode": 420
      },
      {
        "path": "/usr/local/etc/k3d/manifests/jellyfin.yaml",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/3xTXY/aMBB8z6/YPxACJ7Xq+Q0BrWg5iq7cnfqEjL3AFse27E1U+usrB8JH6PXNHs+OZ8frPM8z6ekVQyRnBdSDbE9WC1g4nZXIUkuWIgMwco0mphWA9F7ALzTmsCGbAVhZ4hUQPapElBW70lWWf2CoSeFQqbRbuj1aARtpImYAylmWZDE04jmgrY+35Cfdr5PZ7Ofn6Xy1qNaG4g510sPwEkzDA6ilqVDAjtmLohj0ex/6vX7vQXzqP35sKFTKLQrQTu0x9MgVrdfzQhjJGLlhd9pJkHeBY2vr7HjhAgs43wKwc5E74D398aF/T2/BiKoKxIeRs4y/WZyYSnq5JkNMGFsMQAfnL7scRsPF6unb/Pu4g80ny9Xz8K2DDl/G0+Xq7Xm6nDQntTNViU/pic6tNs+3kLwTUJSoSZ40jhFdkFumkmqHN8wL0mE6u6HtDbXNPU9nua/VP8o01oUOdFOnsc5b7J0UfaCaDG5RC+BQJUNo5drgaUBnZPfxMpnHQE5j2bxVur3VOjqpZSjSFyluxgWADx4FjCmgYhcO2X1o+X/79elDRkbLr42LkZFUnqchbeb31Veql8Cx9HwYU2iLI/3BGZXEAgZf6KrkOsB3um1z/xsAAP//RGn7kDYEAAA="
        },
        "mode": 420
      },
      {
        "path": "/usr/local/etc/k3d/manifests/pihole-pvc_config.yaml",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/yyNsU7rQBBF+/2KK7m2n6JH5TYFBUIgkEI92R3Ho6x3zM6sKRD/jmJSnqujczu808bwmaHN1+bQCT6LYZLMoJLQjHFtZ46eESuTM/oJrpBl1eqhgzikuOKpnbkWdrYhdKHDcbcTvsRnrJoWKv3D8H84BFrlxNVEy4jtEK5S0ojX22LOxU+a28LHTLKEhZ0SOY0BoFLUyUWL3RDYdnH4aw+i/1KVjeuIrJFyAAotPGKVWTP3Ucskl2Arx70WI5s9a+K91uONKX1UcX4pkQNQ2bTVyPezyp+Nze8EmGulC484PEowJ2824vsnhN8AAAD//4HGPmpVAQAA"
        },
        "mode": 420
      },
      {
        "path": "/usr/local/etc/k3d/manifests/pihole-pvc_log.yaml",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/yyOwW7VMBBF9/6Kq2adkJfAxtsuWCAEgqpI7Kb2vGZU2xPscVgg/r1q+pZ3dDTnDPhJB8M2hnbbu0GvsE0arpIYVCJ6Y7z0Jw6WECqTMcYrTCF512pugBikmOJLf+Ja2LhNbnAD7k864q/Yhl1jpjJ+nNbp4miXR65NtHgcF/ciJXp8f7s042KPmnrm+0SSXWajSEbeAVSKGploaW8TOE5wev89iX6IVQ6uHkkDJYf3YNHyIJmbUd497pZ5Wcd5Gef1YZn9Mvv10+87BxTK7LHLponHpM+u7RxObQjc2leNfGpH/GCKv6oYfyuBHVC5aa+Bb1WV/3RudltAM630zB6Xz+KakfXm8e+/c68BAAD//zBAOhp+AQAA"
        },
        "mode": 420
      },
      {
        "path": "/usr/local/etc/k3d/manifests/pihole.yaml",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/6RUTW/jNhC981cM4Gsl27tdNNXNcALU2MQ2EiXb7cWgqZFFmOIQ5EjZ/PuCtKzE2QYtUPhgzvC9Nx+c0QQeZI/ADQJ17DoGqoEbHaDWBkHaCrqAcOz2qNiA8igZIauBCXTryLOYgGbQlgm+dnv0FhlDLiZiAsuEruBZcwOOqlba7Nf8cz4XYgLrTXlTwKqGF+rggBZ9wqbYL7I1UHtqQVrorPO61wYPWKWEPBEbDGGQBEWWpbbogWwkPNzcatv9EBNAK/cGKwgvgbH9BVSD6piKHajnuKlAiB4nDwg1eQiMLsQyazKGnuMJbeh8bJbkmLWPKtMxuphAI0NS9/rQMDj0rQ5Bk006UqmYdLzvyXQtBpBVhVUusiwT0ukn9BFcQD8XR22rArZUiRZZVpJlIQCM3KMJ8QQgnSvA6YYMCgArWxzN4FBFkOyYWuosP6DvtcKFUtEq6Yi2gFqaEKljAUk4A7T9KUI2qG7vN39+391ulotytVmnK4Bemg7fJPAKf1rdl4+L290fm4fyX8ExM/Sr7SVwPsu/zPJZ/ukCW/51iVq06LWS0zU+776TP16AY/T14u7mwwx0Kw9YQEXqiD7XND3dDX+FkYyBE/Kit9ERxz6cezS2b0ueC/jyeYjYUOB3LueJSZEpoFxu/w/98foD+tXsJ/rV7Or35AyoOq/5ZUmW8QcXA1JJJ/faaNYYzj6AypN7tTJYLra7u6/rzfU73/qm3N0vvr3zLh6vV+Xu2/2qPPX/NO93cfjGvqXB3EpuCpj20k8NHaaDzNuGZ4YOmevVP7CQ1fnRLojIKhvIJ2Jlw5JsrQ/F+J4hzd2YzPzTb3kcuPnZztNPwPAJGRboVttjeN2c2ORzrvkwHcNqn1bpw0JcXPXAaPkp4ZdG6nZ8kWis31Hf6P1U33/Xe6UK8XcAAAD//z1CxJr7BQAA"
        },
        "mode": 420
      }
    ],
    "filesystems": [
      {
        "device": "/dev/disk/by-partlabel/containers",
        "format": "btrfs",
        "path": "/var",
        "wipeFilesystem": true
      }
    ]
  },
  "systemd": {
    "units": [
      {
        "contents": "# Generated by Butane\n[Unit]\nBefore=local-fs.target\nRequires=systemd-fsck@dev-disk-by\\x2dpartlabel-containers.service\nAfter=systemd-fsck@dev-disk-by\\x2dpartlabel-containers.service\n\n[Mount]\nWhere=/var\nWhat=/dev/disk/by-partlabel/containers\nType=btrfs\n\n[Install]\nRequiredBy=local-fs.target",
        "enabled": true,
        "name": "var.mount"
      },
      {
        "enabled": true,
        "name": "podman.socket"
      },
      {
        "enabled": false,
        "mask": true,
        "name": "docker.service"
      },
      {
        "enabled": true,
        "mask": true,
        "name": "docker.socket"
      },
      {
        "enabled": false,
        "mask": true,
        "name": "nm-cloud-setup.service"
      },
      {
        "enabled": false,
        "mask": true,
        "name": "nm-cloud-setup.socket"
      },
      {
        "contents": "[Unit]\nDescription=Install Admin Packages\nAfter=network-online.target\nWants=network-online.target\nConditionPathExists=!/var/lib/%N.stamp\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nRestart=on-failure\nRestartSec=60\nExecStart=/usr/bin/rpm-ostree install -y --apply-live --allow-inactive \\\n    vim \\\n    kubernetes-client\n\nExecStart=/bin/touch /var/lib/%N.stamp\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "rpm-ostree-install-pkgs.service"
      },
      {
        "contents": "[Unit]\nDescription=k3s bootstrapper\nAfter=network-online.target\nWants=network-online.target\nAfter=rpm-ostree-install-k3s-selinux.service\nConditionPathExists=!/var/lib/%N.stamp\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nRestart=on-failure\nEnvironment=DOCKER_SOCK=/run/podman/podman.sock\nExecStartPre=/usr/bin/ln -s /run/podman/podman.sock /var/run/docker.sock\nExecStart=/bin/touch /var/lib/%N.stamp\nExecStart=/usr/local/bin/k3d-create-cluster.sh\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "k3d-install-cluster.service"
      }
    ]
  }
}
